---
author: David L Blodgett
date: 2017-04-22
slug: nldi-intro
type: post
title: The Hydro Network-Linked Data Index
categories: Data Science
tags:
  - leaflet
  - R
  - web services
image: static/basemaps/screenshot.png
description: Access simple subsets of NHDPlus data and discover sites on the network with the Hydro Network-Linked Data Index.
keywords:
  - hydrography
  - data discovery
  - NHDPlus
  - dataRetrieval
author_github: dblodgett-usgs
author_email: <dblodgett@usgs.gov>
---

## Introduction

The [Hydro Network-Linked Data Index (NLDI)](https://cida.usgs.gov/nldi/about) is a system that can index data to [NHDPlus V2](http://www.horizon-systems.com/NHDPlus/V2NationalData.php) catchments and flow lines and offers a search service to discover indexed information. Data linked to the NLDI includes [active NWIS stream gages](https://waterdata.usgs.gov/nwis/rt), [water quality portal sites](https://www.waterqualitydata.us/), and [outlets of HUC12 watersheds](https://www.sciencebase.gov/catalog/item/5762b664e4b07657d19a71ea). The NLDI is a core product of the [Open Water Data Initiative](http://acwi.gov/spatial/owdi/) and is being developed [an open source project.](https://github.com/ACWI-SSWD) coordinated through the Advisory Committee on Water Information (ACWI) Subcommittee on Spatial Water Data.

In this blog post, we introduce the basic functions of the NLDI and show ho to use it as a data discovery and access tool in R. The first section describes the operations available from NLDI's Web API. The second section shows how to use the NLDI to discover data to be accessed with [the dataRetrieval package.](https://owi.usgs.gov/blog/tags/dataretrieval/)
 
## The NLDI Web API

The NLDI's Web API follows a losely RESTful design and is documented with [swagger](http://swagger.io/) documentation which can [be found here.](https://cida.usgs.gov/nldi/swagger-ui.html) Every request to get data from the NLDI starts from a given network linked feature.  

### Feature Sources
Available network linked feature sources (`featureSource`s) can be found from the [getDataSources request.](https://cida.usgs.gov/nldi/swagger-ui.html#!/lookup-controller/getDataSourcesUsingGET) _(hint: Click the `try it out` button on the swagger page!)_ These are the collections of network linked features the NLDI knows about. Think of them as watershed outlets that can be used as a starting point. For this demo, we'll use NWIS Stream Gages as the `featureSource`. As a note for later, `featureSource` here is the same as the `dataSource` described below.   

### Feature IDs
For now, the particular `featureID` to be accessed from a given `featureSource` needs to be found outside the NLDI, so the [getFeatures](https://cida.usgs.gov/nldi/swagger-ui.html#!/lookup-controller/getFeaturesUsingGET_1) request doesn't return anything. So let's use a [well known NWIS Streamgage](https://www.usgs.gov/news/first-usgs-streamgage-records-125-years-measuring-new-mexico%E2%80%99s-vital-water-resources) on the [Rio Grande at Embudo NM](https://waterdata.usgs.gov/nwis/inventory/?site_no=08279500&agency_cd=USGS) as our starting point. 

### Indexed Features
We can use the [getRegisteredFeature](https://cida.usgs.gov/nldi/swagger-ui.html#!/lookup-controller/getRegisteredFeatureUsingGET) request to see this feature. Enter `nwissite` and `USGS-08279500` in the `featureSource` and `featureID`, respectively, in the [swagger demo page.](https://cida.usgs.gov/nldi/swagger-ui.html#!/lookup-controller/getRegisteredFeatureUsingGET) You can also see this in your browser at this url: [https://cida.usgs.gov/nldi/nwissite/USGS-08279500](https://cida.usgs.gov/nldi/nwissite/USGS-08279500) The response contains the location of the feature, is in [geojson](http://geojson.org/), and looks like:
```
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "geometry": {
        "type": "Point",
        "coordinates": [
          -105.9639722,
          36.20555556
        ]
      },
      "properties": {
        "source": "nwissite",
        "sourceName": "NWIS Sites",
        "identifier": "USGS-08279500",
        "name": "RIO GRANDE AT EMBUDO, NM",
        "uri": "https://waterdata.usgs.gov/nwis/inventory?agency_code=USGS&site_no=08279500",
        "comid": "17864756",
        "navigation": "https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate"
      }
    }
  ]
}
```
### Navigation
The _navigation_ property of the returned feature is a url for the [_getNavigationTypes_](https://cida.usgs.gov/nldi/swagger-ui.html#!/lookup-controller/getNavigationTypesUsingGET) request. This request provides four _navigation_ options as shown below. Each of these URLs returns the NHDPlus flowlines for the navigation type.
```
{
  "upstreamMain": "https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UM",
  "upstreamTributaries": "https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UT",
  "downstreamMain": "https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/DM",
  "downstreamDiversions": "https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/DD"
}
```
### Get Flowlines from Navigation
Each of the URLs found via the _getNavigationTypes_ request is a complete [_getFlowlines_](https://cida.usgs.gov/nldi/swagger-ui.html#!/linked-data-controller/getFlowlinesUsingGET) request. This request has some optional input parameters. The most useful being `distance`, which allows specification of a distance to navigate in km. So, for example, we can use this to retrieve 10km of upstream mainstem flowlines from the NWIS gage 08279500 with a request like: [https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UM?distance=10](https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UM?distance=10)

### Get Linked Data from Navigation
Now that we have a `featureSource` = `nwissite`, a `featureID` = `USGS-082795001`, the `navigate` operation on the feature, and the `navigationMode` = `UM` with `distance` = `10`km, we can use the [_getFeatures_](https://cida.usgs.gov/nldi/swagger-ui.html#!/linked-data-controller/getFeaturesUsingGET) request to discover features from any `featureSource` which, in the context of a _getFeatures_ request is called a `dataSource`. Setting the `dataSource` = `nwissite` and taking off the distance filter, we can see if there are any active NWIS streamgages upstream on the main stem with a request that looks like: [https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UM/nwissite](https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UM/nwissite)  

### Get the Upstream Basin Boundary
So far, we've covered four parameters of the NLDI Web API. The two base parameters, `featureSource` and `featureID`, and two that apply to the `navigate` option, `navigationMode` and `distance`. In addition to the `navigate` option, the NLDI offers a `basin` option for any `featureSource`/`featureID`. The [_getBasin_](https://cida.usgs.gov/nldi/swagger-ui.html#!/characteristics-controller/getBasinUsingGET) operation doesn't require any additional parameters, so a request to get the basin for our stream gage liiks like: [https://cida.usgs.gov/nldi/nwissite/USGS-08279500/basin](https://cida.usgs.gov/nldi/nwissite/USGS-08279500/basin).

### NLDI API Summary
There are a few other options available from the NLDI that are not covered here. One, that is coming soon, make catchment (local incremental NHDPlus catchment) and basin (upstream accumulation) landscape characteristics available. This functionality and data is available but is preliminary and subject to change. There are also two options on the `navigate` option, legacy and stopComid, that are also preliminary and subject to change. Look for a future blog post showing how to access these operations.  

Bringing together all the operations summarized above, we can get 
1) The NWIS site: https://cida.usgs.gov/nldi/nwissite/USGS-08279500
2) The basin upstream of the site: https://cida.usgs.gov/nldi/nwissite/USGS-08279500/basin
3) All upstream with tributaries flowlines: https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UT
4) The upstream mainstem flowlines: https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UM
5) The downstream mainstem flowlines https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/DM
6) The water quality observation sites in upstream catchments: https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/UT/wqp
7) The water quality observations in downstream catchments: https://cida.usgs.gov/nldi/nwissite/USGS-08279500/navigate/DM/wqp

Using [QGIS](http://qgis.org/en/site/) to render the geojson from each of these urls (note you can use the URLs directly in the "Add Vector Layer" dialogue in QGIS) we get something that looks like the following two screenshots.  

<img src='/static/nldi/upstream.png'/ title='Upstream Navigation Results' alt='Image of upstream navitation results. Basin bounday, flowlines, main stem, water quality sites.'/> <img src='/static/nldi/downstream.png'/ title='Downstream Navigation Results' alt='Image of downstream navitation results. Main stem, water quality sites.'/>


